#include <sys/ptrace.h>
#include <sys/wait.h>
#include <sys/user.h>
#include <unistd.h>
#include <stdio.h>

int main(int argc, char *argv[]) {
    pid_t pid = atoi(argv[1]);
    ptrace(PTRACE_ATTACH, pid, NULL, NULL);
    waitpid(pid, NULL, 0);

    struct user_regs_struct regs;
    ptrace(PTRACE_GETREGS, pid, NULL, &regs);
    printf("RIP = %llx\n", regs.rip);

    // misalnya ubah instruksi di RIP
    long orig = ptrace(PTRACE_PEEKDATA, pid, regs.rip, NULL);
    long patch = (orig & ~0xff) | 0xcc; // INT3 (breakpoint)
    ptrace(PTRACE_POKEDATA, pid, regs.rip, patch);

    ptrace(PTRACE_CONT, pid, NULL, NULL);
    return 0;
}

